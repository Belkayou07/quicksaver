/*! For license information please see sidepanel.js.LICENSE.txt */
(()=>{function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(){"use strict";n=function(){return r};var e,r={},o=Object.prototype,a=o.hasOwnProperty,i=Object.defineProperty||function(t,n,e){t[n]=e.value},c="function"==typeof Symbol?Symbol:{},s=c.iterator||"@@iterator",u=c.asyncIterator||"@@asyncIterator",l=c.toStringTag||"@@toStringTag";function f(t,n,e){return Object.defineProperty(t,n,{value:e,enumerable:!0,configurable:!0,writable:!0}),t[n]}try{f({},"")}catch(e){f=function(t,n,e){return t[n]=e}}function p(t,n,e,r){var o=n&&n.prototype instanceof b?n:b,a=Object.create(o.prototype),c=new N(r||[]);return i(a,"_invoke",{value:O(t,e,c)}),a}function h(t,n,e){try{return{type:"normal",arg:t.call(n,e)}}catch(t){return{type:"throw",arg:t}}}r.wrap=p;var d="suspendedStart",v="suspendedYield",y="executing",m="completed",g={};function b(){}function w(){}function E(){}var L={};f(L,s,(function(){return this}));var x=Object.getPrototypeOf,k=x&&x(x(R([])));k&&k!==o&&a.call(k,s)&&(L=k);var S=E.prototype=b.prototype=Object.create(L);function A(t){["next","throw","return"].forEach((function(n){f(t,n,(function(t){return this._invoke(n,t)}))}))}function j(n,e){function r(o,i,c,s){var u=h(n[o],n,i);if("throw"!==u.type){var l=u.arg,f=l.value;return f&&"object"==t(f)&&a.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,c,s)}),(function(t){r("throw",t,c,s)})):e.resolve(f).then((function(t){l.value=t,c(l)}),(function(t){return r("throw",t,c,s)}))}s(u.arg)}var o;i(this,"_invoke",{value:function(t,n){function a(){return new e((function(e,o){r(t,n,e,o)}))}return o=o?o.then(a,a):a()}})}function O(t,n,r){var o=d;return function(a,i){if(o===y)throw Error("Generator is already running");if(o===m){if("throw"===a)throw i;return{value:e,done:!0}}for(r.method=a,r.arg=i;;){var c=r.delegate;if(c){var s=_(c,r);if(s){if(s===g)continue;return s}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(o===d)throw o=m,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);o=y;var u=h(t,n,r);if("normal"===u.type){if(o=r.done?m:v,u.arg===g)continue;return{value:u.arg,done:r.done}}"throw"===u.type&&(o=m,r.method="throw",r.arg=u.arg)}}}function _(t,n){var r=n.method,o=t.iterator[r];if(o===e)return n.delegate=null,"throw"===r&&t.iterator.return&&(n.method="return",n.arg=e,_(t,n),"throw"===n.method)||"return"!==r&&(n.method="throw",n.arg=new TypeError("The iterator does not provide a '"+r+"' method")),g;var a=h(o,t.iterator,n.arg);if("throw"===a.type)return n.method="throw",n.arg=a.arg,n.delegate=null,g;var i=a.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=e),n.delegate=null,g):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,g)}function P(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function U(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function N(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(P,this),this.reset(!0)}function R(n){if(n||""===n){var r=n[s];if(r)return r.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var o=-1,i=function t(){for(;++o<n.length;)if(a.call(n,o))return t.value=n[o],t.done=!1,t;return t.value=e,t.done=!0,t};return i.next=i}}throw new TypeError(t(n)+" is not iterable")}return w.prototype=E,i(S,"constructor",{value:E,configurable:!0}),i(E,"constructor",{value:w,configurable:!0}),w.displayName=f(E,l,"GeneratorFunction"),r.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===w||"GeneratorFunction"===(n.displayName||n.name))},r.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,E):(t.__proto__=E,f(t,l,"GeneratorFunction")),t.prototype=Object.create(S),t},r.awrap=function(t){return{__await:t}},A(j.prototype),f(j.prototype,u,(function(){return this})),r.AsyncIterator=j,r.async=function(t,n,e,o,a){void 0===a&&(a=Promise);var i=new j(p(t,n,e,o),a);return r.isGeneratorFunction(n)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},A(S),f(S,l,"Generator"),f(S,s,(function(){return this})),f(S,"toString",(function(){return"[object Generator]"})),r.keys=function(t){var n=Object(t),e=[];for(var r in n)e.push(r);return e.reverse(),function t(){for(;e.length;){var r=e.pop();if(r in n)return t.value=r,t.done=!1,t}return t.done=!0,t}},r.values=R,N.prototype={constructor:N,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=e,this.done=!1,this.delegate=null,this.method="next",this.arg=e,this.tryEntries.forEach(U),!t)for(var n in this)"t"===n.charAt(0)&&a.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=e)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var n=this;function r(r,o){return c.type="throw",c.arg=t,n.next=r,o&&(n.method="next",n.arg=e),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],c=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var s=a.call(i,"catchLoc"),u=a.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,n){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc<=this.prev&&a.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var o=r;break}}o&&("break"===t||"continue"===t)&&o.tryLoc<=n&&n<=o.finallyLoc&&(o=null);var i=o?o.completion:{};return i.type=t,i.arg=n,o?(this.method="next",this.next=o.finallyLoc,g):this.complete(i)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),g},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.finallyLoc===t)return this.complete(e.completion,e.afterLoc),U(e),g}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var e=this.tryEntries[n];if(e.tryLoc===t){var r=e.completion;if("throw"===r.type){var o=r.arg;U(e)}return o}}throw Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:R(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=e),g}},r}function e(t,n){(null==n||n>t.length)&&(n=t.length);for(var e=0,r=Array(n);e<n;e++)r[e]=t[e];return r}function r(t,n,e,r,o,a,i){try{var c=t[a](i),s=c.value}catch(t){return void e(t)}c.done?n(s):Promise.resolve(s).then(r,o)}function o(t){return function(){var n=this,e=arguments;return new Promise((function(o,a){var i=t.apply(n,e);function c(t){r(i,o,a,c,s,"next",t)}function s(t){r(i,o,a,c,s,"throw",t)}c(void 0)}))}}document.addEventListener("DOMContentLoaded",(function(){var t=document.querySelectorAll(".tab"),r=document.querySelectorAll(".tab-content"),a=null,i="EUR";function c(){return(c=o(n().mark((function t(){var e,r;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://api.exchangerate-api.com/v4/latest/EUR");case 3:return e=t.sent,t.next=6,e.json();case 6:r=t.sent,a=r.rates,console.log("Exchange rates loaded:",a),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(0),console.error("Error fetching exchange rates:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[0,11]])})))).apply(this,arguments)}function s(t,n,e){if(!a||n===e)return t;var r="EUR"===n?t:t/a[n];return"EUR"===e?r:r*a[e]}function u(t,n){return new Intl.NumberFormat(void 0,{style:"currency",currency:n}).format(t)}!function(){c.apply(this,arguments)}(),navigator.geolocation&&navigator.geolocation.getCurrentPosition(function(){var t=o(n().mark((function t(e){var r,o;return n().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=".concat(e.coords.latitude,"&longitude=").concat(e.coords.longitude));case 3:return r=t.sent,t.next=6,r.json();case 6:o=t.sent,i={UK:"GBP",SE:"SEK",FR:"EUR",BE:"EUR",NL:"EUR",DE:"EUR",IT:"EUR",ES:"EUR"}[o.countryCode]||"EUR",console.log("Detected user currency:",i),t.next=15;break;case 12:t.prev=12,t.t0=t.catch(0),console.error("Error detecting user location:",t.t0);case 15:case"end":return t.stop()}}),t,null,[[0,12]])})));return function(n){return t.apply(this,arguments)}}()),t.forEach((function(n){n.addEventListener("click",(function(){t.forEach((function(t){return t.classList.remove("active")})),r.forEach((function(t){return t.classList.remove("active")})),n.classList.add("active");var e=n.dataset.tab;document.getElementById(e).classList.add("active")}))}));var l=document.querySelector(".product-info"),f=l.querySelector(".loading"),p=l.querySelector(".content");chrome.runtime.onMessage.addListener((function(t,n,r){"UPDATE_PRODUCT_INFO"===t.type&&function(t){var n,r,o;if(f.classList.add("hidden"),t){var a,c=s(t.price,t.currency,i),l=t.currency!==i?'<div class="original-price">('.concat(u(t.price,t.currency),")</div>"):"",h=t.alternativeMarketplaces?(o=t.alternativeMarketplaces,function(t){if(Array.isArray(t))return e(t)}(o)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(o)||function(t,n){if(t){if("string"==typeof t)return e(t,n);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?e(t,n):void 0}}(o)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort((function(t,n){return s(t.price,t.currency,i)-s(n.price,n.currency,i)})):[],d='\n      <div class="product-details">\n        <h3 class="product-title">'.concat(t.title,'</h3>\n        <div class="product-meta">\n          <div class="price-info">\n            <span class="label">Current Price:</span>\n            <span class="price">').concat(u(c,i),"</span>\n            ").concat(l,'\n          </div>\n          <div class="marketplace-info">\n            <span class="label">Marketplace:</span>\n            <span class="marketplace">Amazon ').concat(t.marketplace,'</span>\n          </div>\n          <div class="product-id">\n            <span class="label">ASIN:</span>\n            <span class="asin">').concat(t.asin,'</span>\n          </div>\n          <div class="shipping-status ').concat((a=null===(n=t.shippingAvailability)||void 0===n?void 0:n.canShip,!0===a?"shipping-available":!1===a?"shipping-unavailable":"shipping-unknown"),'">\n            <span class="label">Shipping:</span>\n            <span class="status">').concat((null===(r=t.shippingAvailability)||void 0===r?void 0:r.message)||"Unknown","</span>\n          </div>\n        </div>\n      </div>\n    "),v=h.length>0?'\n      <div class="status-card">\n        <h2>Better Prices Found</h2>\n        <div class="markets-list">\n          '.concat(h.map((function(t){var n=s(t.price,t.currency,i),e=t.currency!==i?'<span class="original-price">('.concat(u(t.price,t.currency),")</span>"):"",r=((n-c)/c*100).toFixed(1),o=r<0?"price-lower":r>0?"price-higher":"price-equal",a=0!==r?'<span class="price-difference '.concat(o,'">(').concat(r>0?"+":"").concat(r,"%)</span>"):"";return'\n              <div class="market-item '.concat(o,'" data-url="').concat(t.url,'">\n                <div class="market-info">\n                  <div class="market-name">Amazon ').concat(t.marketplace,'</div>\n                  <div class="market-price">\n                    ').concat(u(n,i),"\n                    ").concat(e,"\n                    ").concat(a,"\n                  </div>\n                </div>\n              </div>\n            ")})).join(""),"\n        </div>\n      </div>\n    "):"";p.innerHTML='\n      <div class="status-card">\n        <h2>Current Product</h2>\n        '.concat(d,"\n      </div>\n      ").concat(v,"\n    "),h.length>0&&document.querySelectorAll(".market-item").forEach((function(t){t.addEventListener("click",(function(){chrome.tabs.create({url:t.dataset.url})}))}))}else p.innerHTML='\n        <div class="no-product">\n          <p>No Amazon product detected</p>\n          <p class="hint">Visit an Amazon product page to start comparing prices</p>\n        </div>\n      '}(t.data)})),f.classList.remove("hidden")}))})();