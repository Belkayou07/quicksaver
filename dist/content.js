(()=>{function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function n(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,r(i.key),i)}}function r(t){var n=function(t){if("object"!=e(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,"string");if("object"!=e(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==e(n)?n:n+""}var i=new(function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.productData=null,this.debug=!0},(r=[{key:"log",value:function(e,t){this.debug&&console.log("[Quick-Saver] ".concat(e),t||"")}},{key:"extractProductData",value:function(){var e=window.location.href;if(this.log("Checking URL:",e),!this.isProductPage(e))return this.log("Not a product page"),null;var t={title:this.getProductTitle(),price:this.getProductPrice(),asin:this.getProductASIN(),currency:this.getCurrency(),marketplace:this.getMarketplace(),shipping:this.getShippingInfo(),shippingAvailability:this.getShippingAvailability(),url:window.location.href,image:this.getProductImage(),originalPrice:this.getProductPrice(),originalCurrency:this.getCurrency()};return this.log("Extracted product data:",t),t.title&&t.price&&t.asin?t:(this.log("Missing essential product data"),null)}},{key:"isProductPage",value:function(e){var t=e.includes("/dp/")||e.includes("/gp/product/")||e.includes("/product/")||null!==document.querySelector("#productTitle");return this.log("Product page detection:",t),t}},{key:"getProductTitle",value:function(){for(var e=0,t=["#productTitle","#title",".product-title"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r){var i=r.textContent.trim();return this.log("Found title using selector:",n),i}}return this.log("No title found"),null}},{key:"getProductPrice",value:function(){for(var e=0,t=[".priceToPay span.a-offscreen","#priceblock_ourprice","#priceblock_dealprice",".a-price .a-offscreen",'.a-price span[aria-hidden="true"]',"#price_inside_buybox","#newBuyBoxPrice","#price"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r){var i=r.textContent.trim();this.log("Found price using selector:",n),this.log("Raw price text:",i);var o=i.replace(/[^0-9,\.]/g,"").replace(",","."),a=parseFloat(o);if(!isNaN(a))return this.log("Parsed price:",a),a}}return this.log("No valid price found"),null}},{key:"getProductASIN",value:function(){var e=null,n=window.location.pathname.match(/\/(dp|gp\/product|product)\/([A-Z0-9]{10})/);if(n)return e=n[2],this.log("Found ASIN in URL:",e),e;var r=document.querySelector("[data-asin]");if(r)return e=r.getAttribute("data-asin"),this.log("Found ASIN in data attribute:",e),e;var i,o=function(e,n){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,n){if(e){if("string"==typeof e)return t(e,n);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?t(e,n):void 0}}(e))||n&&e&&"number"==typeof e.length){r&&(e=r);var i=0,o=function(){};return{s:o,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,u=!0,c=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return u=e.done,e},e:function(e){c=!0,a=e},f:function(){try{u||null==r.return||r.return()}finally{if(c)throw a}}}}(document.getElementsByTagName("meta"));try{for(o.s();!(i=o.n()).done;){var a=i.value.getAttribute("content");if(a&&a.match(/[A-Z0-9]{10}/))return e=a.match(/[A-Z0-9]{10}/)[0],this.log("Found ASIN in meta tag:",e),e}}catch(e){o.e(e)}finally{o.f()}return this.log("No ASIN found"),null}},{key:"getProductImage",value:function(){for(var e=0,t=["#landingImage","#imgBlkFront","#main-image","#productImage"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r&&r.src)return this.log("Found image using selector:",n),r.src}return this.log("No product image found"),null}},{key:"getCurrency",value:function(){switch(this.getMarketplace()){case"UK":return"GBP";case"SE":return"SEK";default:return"EUR"}}},{key:"getMarketplace",value:function(){var e=window.location.hostname,t=null;return e.includes("amazon.fr")?t="FR":e.includes("amazon.nl")?t="NL":e.includes("amazon.be")?t="BE":e.includes("amazon.de")?t="DE":e.includes("amazon.it")?t="IT":e.includes("amazon.es")?t="ES":e.includes("amazon.se")?t="SE":e.includes("amazon.co.uk")&&(t="UK"),this.log("Detected marketplace:",t),t}},{key:"getShippingInfo",value:function(){for(var e=0,t=["#deliveryMessageMirId","#delivery-message","#mir-layout-DELIVERY_BLOCK",".delivery-message"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r){var i=r.textContent.trim();return this.log("Found shipping info using selector:",n),i}}return this.log("No shipping info found"),null}},{key:"getShippingAvailability",value:function(){for(var e=0,t=[".delivery-restriction-message","#deliveryBlockMessage","#shipping-restriction-message",".a-box-error"];e<t.length;e++){var n=t[e],r=document.querySelector(n);if(r){var i=r.textContent.toLowerCase();if(i.includes("cannot be shipped")||i.includes("cannot ship")||i.includes("does not ship")||i.includes("niet verzonden")||i.includes("ne peut pas être livré")||i.includes("nie może zostać wysłany"))return this.log("Found shipping restriction:",i),{canShip:!1,message:r.textContent.trim()}}}var o=document.querySelector("#deliveryMessageMirId, #delivery-message");if(o){var a=o.textContent.toLowerCase();if(a.includes("delivered")||a.includes("delivery")||a.includes("ships to")||a.includes("verzending")||a.includes("livraison")||a.includes("wysyłka"))return{canShip:!0,message:o.textContent.trim()}}return{canShip:null,message:"Shipping availability unknown"}}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r}());function o(){var e=i.extractProductData();e?(console.log("[Quick-Saver] Sending product data to extension:",e),chrome.runtime.sendMessage({type:"PRODUCT_DATA",data:e})):console.log("[Quick-Saver] No valid product data to send")}console.log("[Quick-Saver] Content script loaded, attempting initial product detection"),setTimeout(o,1e3);var a=location.href;new MutationObserver((function(){location.href!==a&&(a=location.href,console.log("[Quick-Saver] URL changed, attempting product detection"),setTimeout(o,1e3))})).observe(document,{subtree:!0,childList:!0})})();